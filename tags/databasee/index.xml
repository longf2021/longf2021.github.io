<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Databasee on 隆飞的博客</title><link>https://longfeis.me/tags/databasee/</link><description>Recent content in Databasee on 隆飞的博客</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><copyright>Longfei.</copyright><lastBuildDate>Tue, 16 Mar 2021 23:21:17 +0800</lastBuildDate><atom:link href="https://longfeis.me/tags/databasee/index.xml" rel="self" type="application/rss+xml"/><item><title>基于MySQL的rownum伪列功能</title><link>https://longfeis.me/posts/realize-rownum/</link><pubDate>Tue, 16 Mar 2021 23:21:17 +0800</pubDate><guid>https://longfeis.me/posts/realize-rownum/</guid><description>rownum伪列功能 伪列的含义就是说：实际上该列并不存在，但是你可以直接像正常的列一样使用它。rownum伪列是Oracle用来标记返回数据行号的。Oracle中没有limit，通过在where条件中使用rownum伪列，可以达到跟MySQL中limit类似的效果。
使用时需要注意以下几点：
rownum的生成时机。跟rownum窗口函数类似，是在最后的order by之前生成。 where条件中的“rownum&amp;gt;正整数”将会导致select结果为空 rownum最常见的应用是topN，即前几名的场景，但是要区分以下两种sql，其效果是完全不一样的。
-- 对t表的前N行数据按成绩排序 select rownum, t.* from t where rownum &amp;lt; N order by grade; -- 取前N名 select rownum, T.* from (select * from t order by grade) T where rownum &amp;lt; N; 架构与设计 架构 如上图所示，这是我画的一个架构图，很简单的一个基于MySQL的分布式数据库的实现方案（maybe中间件？）。其中，gate是整个系统的入口，负责根据meta data，将sql转发到底下的MySQL上。
我们的任务就是在这个架构上实现类似Oracle中的rownum伪列的功能。
设计 总体思想：取到数据之后，在order by之前，为每行加上行号，并根据where条件中的rownum表达式，完成数据的过滤。
需要拉取的数据太多，但实际上只需要输出少量数据
使用流模式去拉取数据
暂未实现
将rownum改写成一个limit
将rownum转换为limit，下推到每个MySQL上，汇聚数据以后，再在gate上对数据进行添加行号的操作。比如，select rownum,t.* from t where rownum&amp;lt;10; 改写为 select t.* from t limit 10 下推;</description></item></channel></rss>